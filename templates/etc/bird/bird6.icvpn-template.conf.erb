# this is file is generated by puppet

filter icvpn_import_filter {
  if is_ula() then accept;
  if roa_check(icvpn_roa) = ROA_VALID then {
    accept;
  } else {
    print "ROA check failed for ", net, " ASN ", bgp_path.last;
  }
  reject;
}

# template for icvpn route exchange via bgp
template bgp icvpn {
  table mesh;
  local as <%= @icvpn_as %>;
  source address <%= @icvpn_ipv6_address %>;
  import filter icvpn_import_filter;
  export where ((source = RTS_BGP) || (source = RTS_STATIC_DEVICE)) && (is_ula() || is_freifunk());
};
